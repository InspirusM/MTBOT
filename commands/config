const Discord = require(`discord.js`);
const db = require(`quick.db`);
module.exports.run = (client, message, args, prefix) => {

  let perm = new Discord.RichEmbed()
  .setDescription(`To Use This Command You Must Have Manage Server Permission`)
  .setColor(0x80FF00)
  if(!message.member.hasPermission("MANAGE_GUILD")) {
  return message.channel.send(perm);
  }

     if(`${args[0]}` == `set`){
            // Setting Channel
             if(`${args[1]}` == `wchannel`) {
                try {
                    // Embed
                     let mentionEmbed = new Discord.RichEmbed()
                     .setDescription(`**Please mention a channel**\n **>** *${prefix}config help*`)
                    // Return Statements
                     if (!message.member.hasPermission("MANAGE_GUILD")) return message.channel.send(perm, 120000) // This returns if it CANT find the admin perm on them. It then uses the function to send to message.channel, and deletes the message after 120000 milliseconds (2minutes)
                     if (!args.slice(2, 1000, args[2]).join(' ') === 'NONE') return message.channel.send(mentionEmbed) // This returns if they don't message a channel, but we also want it to continue running if they want to disable the log
                
                
                     let newChannel = ''
              
                     const errorReport = client.channels.get(`509187565182517250`)
                     if (args.slice(2, 1000, args[2]).join(' ') === 'NONE')
                     if(`${message.mentions.channels.first()}` == `undefined`) return
                     let channelEmbed = new Discord.RichEmbed()
                     .setDescription(`**Successfully updated welcoming channel to ${message.mentions.channels.first()}**`)
                     .setColor(0x80FF00);
                
                    // Update Channel
                     db.set(`pmessageChannel_${message.guild.id}`, `${message.mentions.channels.first().id}`).then(i => {
                        message.channel.send(channelEmbed) // Finally, send in chat that they updated the channel.
                     })
                }catch(err) {console.log(`Error with setting channel\n${err}`)}
             }
       else if(`${args[1]}` == `autorole`) {
           try {
           
             if (!message.mentions.roles.first()) return message.channel.send(`Please mention a role to set server autorole or see ${prefix}cfg help !`);
             let suc = new Discord.RichEmbed()
             .setDescription(`Server AutoRole Has Been Set To ${message.mentions.roles.first()}`)
             .setColor(0x80FF00)
             db.set(`autorole_${message.guild.id}`, message.mentions.roles.first().id).then(autorole => {
             message.channel.send(suc);
             });
            
           
           } catch (err) {console.log(`Error With Setting Autorole\n${err}`)}
        
        }
       else if(`${args[1]}` == `logs`) {
       try {
    
                     let mentionEmbed = new Discord.RichEmbed()
                     .setDescription(`**Please mention a channel**\n *${prefix}config help*`)
                     .setColor(0x80FF00)
                    // Return Statements
                     if (!message.member.hasPermission("MANAGE_GUILD")) return message.channel.send(perm, 120000) // This returns if it CANT find the admin perm on them. It then uses the function to send to message.channel, and deletes the message after 120000 milliseconds (2minutes)
                     if (!args.slice(2, 1000, args[2]).join(' ') === 'NONE') return message.channel.send(mentionEmbed) // This returns if they don't message a channel, but we also want it to continue running if they want to disable the log
                
                
                     let newChannel = ''
              
                     const errorReport = client.channels.get(`509187565182517250`)
                     if (args.slice(2, 1000, args[2]).join(' ') === 'NONE')
                     if(`${message.mentions.channels.first()}` == `undefined`) return
                     let channelEmbed = new Discord.RichEmbed()
                     .setDescription(`**Successfully updated logs channel to ${message.mentions.channels.first()}**`)
                
                    // Update Channel
                     db.set(`logsChannel_${message.guild.id}`, `${message.mentions.channels.first().id}`).then(i => {
                        message.channel.send(channelEmbed) // Finally, send in chat that they updated the channel.
                     })
       } catch(e) {console.log(e);}
       }
     }
     else if(`${args[0]}` == `help`) {
    let help = new Discord.RichEmbed()
    .addField(`${prefix}config set autorole @role`,`Set AutoRole For Server`)
    .addField(`${prefix}config set wchannel #channel`,`Set Welcome Channel For Server`)
    .addField(`${prefix}config wtest`,`To Test Your Welcomer`)
    .setColor(`#FF7F50`)
     return message.channel.send(help);
     }
    
    else if(`${args[0]}` == `wtest`) {
      let user = message.member;
    client.emit(`guildMemberAdd`,user)
    return message.channel.send(`See Your Server Set Welcome Channel`)
    }
   
};
exports.conf = {
aliases: [""]
};